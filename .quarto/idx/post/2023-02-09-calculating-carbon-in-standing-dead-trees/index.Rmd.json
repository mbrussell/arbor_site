{"title":"Calculating carbon in standing dead trees","markdown":{"yaml":{"title":"Calculating carbon in standing dead trees","author":"Matt Russell","date":"2023-02-10","slug":[],"categories":["Forest carbon"],"tags":["analytics","forest carbon","carbon accounting"]},"headingText":"Standing dead tree data","containsRefs":false,"markdown":"\n\n<center>\n\n![](balsam fir snag Maine.jpg){width=400px}\n\n</center>\n\n\n<center>\n*A standing dead balsam fir tree in Maine.*\n</center>\n\n##\n\nQuantifying the presence and abundance of standing dead trees (SDTs) is notoriously difficult. While live and healthy trees generally appear similar in form and appearance to other live and healthy trees, no two standing dead trees are alike. \n\nTrees that recently died within a few months can have most of their tops and limbs intact. Their foliage may even still be attached. Trees that have been standing dead for a decade or more can only have a portion of the bole remaining with the rest already decaying on the forest floor.   \n\nThese attributes make quantifying the carbon found within SDTs incredibly complex. The popular [Jenkins biomass equations](https://www.fs.usda.gov/research/treesearch/6996) were developed for live trees, and cannot be applied to SDTs directly.  If you're only using common forest inventory measurements like species and diameter, there's really no way to quantify the difference in the amount of carbon in a tree that recently died to one that has been standing dead for decades. \n\nFortunately, most inventories that measure dead wood will collect data on the stage of decay of SDTs. These data are needed to refine estimates of SDT biomass and carbon by including structural loss and decay adjustments.\n\nIn this post I implement a method for quantifying the amount of carbon in standing dead trees using R, drawing especially from functions in the **tidyverse** package. The approach presented here follows the component ratio method approach for determining carbon developed by the USDA Forest Service. A few key resources that go through the methods of this approach:\n\n* [*Accounting for density reduction and structural loss in standing dead trees: implications for forest biomass and carbon stock estimates in the United States*](https://cbmjournal.biomedcentral.com/articles/10.1186/1750-0680-6-14) by Domke et al. 2011. This paper describes the method and how it impacts the Forest Inventory and Analysis data.\n* [Additional file 1 from the paper (PDF).](https://static-content.springer.com/esm/art%3A10.1186%2F1750-0680-6-14/MediaObjects/13021_2011_72_MOESM1_ESM.PDF) The supplemental file presents equations the equations used estimate above and belowground SDT biomass and carbon and provides an example calculation.\n\n\nI compiled a few records of standing dead trees from four Forest Inventory and Analysis plots located in Maine. The four plots were measured in 2021 and the data set contains 10 SDTs. Here is the data that can be read into R with the `tribble()` function from the **tidyverse** package:\n\n```{r, warning = FALSE, message = FALSE}\nlibrary(tidyverse)\n```\n\n```{r}\ntree <- tribble(\n  ~STATECD, ~COUNTYCD, ~PLOT, ~TREE, ~SPCD, ~DIA, ~ACTUALHT, ~DECAYCD,\n  23, 29, 130, 6, 95, 6.7, 27, 3,\n  23, 29, 130, 9, 95, 5.6, 9, 2,\n  23, 29, 688, 1, 12, 7.9, 35, 1,\n  23, 29, 688, 6, 12, 8.6, 31, 1,\n  23, 29, 701, 1, 371, 11, 17, 5,\n  23, 29, 701, 6, 531, 5.5, 49, 1,\n  23, 29, 846, 8, 241, 13.6, 26, 2,\n  23, 29, 846, 12, 12, 6.2, 10, 4,\n  23, 29, 846, 17, 12, 6.8, 5, 4,\n  23, 29, 846, 23, 12, 5.1, 29, 2,\n)\n```\n\nThe variables are:\n\n* `STATECD`: Numeric state ID code (23 = Maine), \n* `COUNTYCD`: Numeric county ID code (29 = Washington County),  \n* `PLOT`: Numeric plot ID code,  \n* `TREE`: Numeric tree ID code,  \n* `SPCD`: Numeric FIA tree species code,  \n* `DIA`: Tree diameter (inches), \n* `ACTUALHT`: Height of the tree (feet), from ground level to the highest remaining portion of the tree, \n* `DECAYCD`: Numeric code indicating the stage of decay in a standing dead tree; ranges from 1 (all limbs and branches are present) to 5 (no evidence of branches remains; top is broken) \n\n\n## Calculating volume, biomass and carbon in standing dead trees\n### Tree volume\nThe first step to calculating the amount of carbon stored in SDTs is to determine their volume. In your region, there are likely regional volume equations that are used for the species you're interested in. For this example, I'll use [equations developed by Honer in 1967](http://ifmlab.for.unb.ca/People/Kershaw/Courses/For1001/Honer.html) which are widely used for commercial species in the northeastern US and Canada.\n\nThe Honer equations predict volume in cubic feet and rely on species, diameter at breast height (`DBH`; measured in inches) and total tree height (`HT`; measured in feet):\n\n$$ VOL = \\frac{DBH^2}{a = \\frac{b}{HT}}$$\nwhere `a` and `b` are species-specific coefficients. \n\nHere is an R function to determine the volumes of the five species of SDTs in the data set:\n\n```{r}\nfx_HONER_VOL <- function(SPCD, DBH, HT){\n       if(SPCD == 12){a = 2.139; b = 301.634}   # balsam fir\n  else if(SPCD == 95){a = 1.588; b = 333.364}   # black spruce\n  else if(SPCD == 241){a = 4.167; b = 244.906}  # northern white-cedar\n  else if(SPCD == 371){a = 1.449; b = 344.754}  # yellow birch\n  else if(SPCD == 531){a = 0.959; b = 334.829}  # American beech\n  VOL = DBH**2/(a+(b/HT))\n  return(VOL)\n  }\n```\n\nNow, we can estimate the total volume of SDTs by applying the function to the `tree` data set. I use the `mutate()` function along with `mapply()` to create the new variable `VOL`:\n\n```{r}\ntree <- tree %>% \n  mutate(VOL = mapply(fx_HONER_VOL, SPCD = SPCD, DBH = DIA, HT = ACTUALHT))\n```\n\nA graph of the tree diameter-volume trends highlights the data. Note that because many of the SDTs may have a broken top, trees can be a large diameter with relatively small volume, which adds some \"noise\" to the relationship:\n\n```{r}\nggplot(tree, aes(x = DIA, y = VOL, col = factor(SPCD))) +\n  geom_point() +\n  labs(x = \"Diameter (in.)\",\n       y = \"Volume (cu.ft.)\")\n```\n\n### Species data\nTo determine biomass and carbon attributes of dead trees, the **species reference data set** (`REF_SPECIES.csv`) provided by the FIA program is a must. This file contains species-specific values of wood density, decay ratios, and more. We'll read the .csv file in from the USDA website, then select the core variables needed to determine biomass and carbon for SDTs:\n\n```{r, warning=F, message=F}\nref_spp <- read_csv(\"C://Users//matt//Documents//Arbor//Projects//FFCP//Central Apps v1//Data//REF_SPECIES.csv\") %>% \n  select(SPCD, WOOD_SPGR_GREENVOL_DRYWT, BARK_SPGR_GREENVOL_DRYWT, BARK_VOL_PCT,\n         WOOD_SPGR_MC12VOL_DRYWT, SFTWD_HRDWD, JENKINS_TOTAL_B1,JENKINS_TOTAL_B2,\n         STANDING_DEAD_DECAY_RATIO1, STANDING_DEAD_DECAY_RATIO2, \n         STANDING_DEAD_DECAY_RATIO3,\n         STANDING_DEAD_DECAY_RATIO4, STANDING_DEAD_DECAY_RATIO5,\n         RAILE_STUMP_DOB_B1, RAILE_STUMP_DIB_B1, RAILE_STUMP_DIB_B2)\n```\n\nNext, we'll join the `ref_spp` data set to the `tree` data set:\n\n```{r}\ntree <- inner_join(tree, ref_spp, by = \"SPCD\")\n```\n\nNow, we'll modify some of the species-specific factors from the reference species table. The `STANDING_DEAD_DECAY_RATIO` variable contains the ratio of decayed wood density to non-decayed wood density. It's stored in five different variables for each of the five different decay classes, so the code below will turn it into a data set organized in a long format:\n\n```{r}\nref_spp_dead <- ref_spp %>% \n  select(SPCD, STANDING_DEAD_DECAY_RATIO1, STANDING_DEAD_DECAY_RATIO2, \n         STANDING_DEAD_DECAY_RATIO3, STANDING_DEAD_DECAY_RATIO4, \n         STANDING_DEAD_DECAY_RATIO5) %>% \n  pivot_longer(STANDING_DEAD_DECAY_RATIO1:STANDING_DEAD_DECAY_RATIO5, \n               names_to = \"DECAY_NAME\", \n               values_to = \"STANDING_DEAD_DECAY_RATIO\") %>% \n  mutate(DECAYCD = as.numeric(str_sub(DECAY_NAME, 26, 26))) %>% \n  select(-DECAY_NAME) %>% \n  relocate(SPCD, DECAYCD, STANDING_DEAD_DECAY_RATIO)\n```\n\nFor example, here are the decay ratios for standing dead trees for the five decay classes for balsam fir:\n\n```{r}\nprint(ref_spp_dead[ref_spp_dead$SPCD == 12, ])\n```\n\n### Structural loss adjustments\nWhile decay ratios account for decay and decomposition of wood, they don't account for structural losses. Standing dead trees experience  sloughing and breakage as a result of wind damage, animal activity, and many more issues. For this, structural loss adjustments are needed to accurately determine the biomass and carbon stored in SDTs.  \n\nThe structural loss adjustments can be obtained in [Table 2 of the Domke et al. paper](https://cbmjournal.biomedcentral.com/articles/10.1186/1750-0680-6-14/tables/2). These decay-class-specific adjustments are for the bole, bark, tops and limbs, stumps, and roots. The table `sla` produces these values. We can then merge the `sla` table with the `ref_spp_dead` table, then merge that to the `tree` table:\n\n```{r}\nsla <- tribble(\n  ~DECAYCD, ~BOLE_SLA, ~BARK_SLA, ~TOP_SLA, ~STUMP_SLA, ~ROOTS_SLA,\n  1, 1, 0.92, 1, 1, 1,\n  2, 1, 0.66, 0.5, 1, 0.95,\n  3, 1, 0.39, 0.20, 1, 0.80,\n  4, 1, 0.21, 0.10, 1, 0.65,\n  5, 1, 0, 0, 1, 0.50)\n\nref_spp_dead <- left_join(ref_spp_dead, sla, by = \"DECAYCD\")\n\ntree <- left_join(tree, ref_spp_dead, by = c(\"SPCD\", \"DECAYCD\")) \n```\n\nPhew! That was a lot of work and we haven't even begun to calculate biomass yet. No fear, now we have all of the variables required in the `tree` data set to begin the biomass and carbon calculations.\n\n## Determing component biomass in standing dead trees\n### Stem and bark \n\nWe start by calculating the biomass in wood found the the stem of the tree ($B_{ODW}$; kg). We will also need the specific gravity of wood for that species, i.e., the `WOOD_SPGR_GREENVOL_DRYWT` variable from the reference species file and `W`, the weight of one cubic meter of water (1,000 kg). The structural loss adjustment for the bole (`BOLE_SLA`) is multiplied by these values:\n$$B_{ODW} = VOL\\times \\text{WOOD_SPGR_GREENVOL_DRYWT}\\times \\\\ W \\times \\text{STANDING_DEAD_DECAY_RATIO}\\times \\text{BOLE_SLA}$$ \n\nThe biomass found in the bark of the tree is the next component to predict($B_{ODB}$; kg). For this we'll also need to know the species-specific values for the percent of wood volume that is bark (`BARK_VOL_PCT`), the specific gravity of bark (BARK_SPGR_GREENVOL_DRYWT), and the structural loss adjustment for the bark component (`BARK_SLA`):\n\n$$B_{ODB} = VOL\\times \\text{BARK_VOL_PCT/100}\\times \\text{BARK_SPGR_GREENVOL_DRYWT} \\times \\\\ W \\times \\text{STANDING_DEAD_DECAY_RATIO}\\times \\text{BARK_SLA}$$ \nTotal SDT bole and bark biomass ($B_{ODT}$) can be found by adding the two components:\n\n$$B_{ODT} = B_{ODW} + B_{ODB}$$ \n\nBecause this approach uses the component ratio method (CRM) to determine biomass stored in SDTs, the next step is to calculate the biomass in each SDT and them compute the ratios. First we need to calculate the bole biomass (kg) from the Jenkins et al. equation (`JENKINS_AG_TREE`). These equations have different parameters for 10 species groups:\n\n$$ \\text{JENKINS_AG_TREE} = exp(\\text{JENKINS_TOTAL_B1} + \\\\ \\text{JENKINS_TOTAL_B2}*log(DIA)) $$\nThe bole ratio from the Jenkins et al. 2003 paper (their Table 6) can be computed for softwood species as:\n\n$$ \\text{BOLE_RATIO_SFWD} = exp(-0.3737 + (-1.8055/(DIA)) $$\nand for hardwood species as:\n\n$$ \\text{BOLE_RATIO_HDWD} = exp(-0.3065 + (-5.4240/(DIA)) $$\n      \n\nRatios of bark can be computed for softwood species as:\n\n$$ \\text{BARK_RATIO_SFWD} = exp(-2.0980 + (-1.1432/(DIA)) $$\n\nand for hardwood species as:\n\n$$ \\text{BOLE_RATIO_HDWD} = exp(-2.0129 + (-5.4240/(DIA)) $$\nMerchantable oven-dry biomass (`MST`) is then calculated as:\n\n$$MST = (\\text{JENKINS_AG_TREE} * \\text{BOLE_RATIO}) + \\\\ (\\text{JENKINS_AG_TREE} * \\text{BARK_RATIO})$$\n\n\nThen, the CRM adjustment factor ($CRM_{AdjFac}$) for each SDT can be calculated as:\n\n$$ CRM_{AdjFac} = B_{ODT}/MST $$\n\n### Stumps\n\nVolume of stumps is calculated next. These equations are adopted from [Raile's equations](https://www.fs.usda.gov/research/treesearch/10745). Stump volume is calculated as:\n\n$$ S_{VOL} = (\\frac{\\pi*DIA^2}{4*144})[((A-B)^2h+11B(A-B)ln(h+1)- \\\\ (\\frac{30.25}{h+1}B^2)]_a^b)\\times0.02832 $$\n\nwhere:\n\n* `S_VOL` is stump volume inside bark ($S_{VISB}$) or outside bark ($S_{VOSB}$), \n* `A` and `B` are species-specific coefficients (`RAILE_STUMP_DOB_B1`, `RAILE_STUMP_DIB_B1`, and `RAILE_STUMP_DIB_B2`), \n* `h` is the height above ground (ft), \n* `a` is the lower stump height (ft; typically set to 0), and \n* `b` is the upper stump height (ft; typically set to one.\n\nThe biomass in the wood of stumps is calculated by multiplying the volume of stumps (inside bark) by the species specific gravity and the weight of water:\n\n$$S_{ODSW} = S_{VISB}\\times \\text{WOOD_SPGR_GREENVOL_DRYWT} \\times W$$\nA similar approach can be used for calculating the biomass in bark, this time subtracting the volume inside and outside the bark:\n\n$$S_{ODSB} = (S_{VOSB}-S_{VISB})\\times \\text{BARK_SPGR_GREENVOL_DRYWT} \\times W$$\nTotal biomass in the stump ($S_{ODT}$) can be calculated by applying the $CRM_{AdjFac}$ and the structural loss adjustment for the stump ($STUMP_{SLA}$):\n\n$$S_{ODT} = (S_{ODSW} + S_{ODSB}) \\times CRM_{AdjFac} \\times STUMP_{SLA}$$\n\n### Tops and limbs\nNext comes estimating the biomass in tops and limbs. Although foliage biomass is not calculated for SDTs, we calculate it to subtract it from total biomass. The foliage ratio is different for softwood and hardwood species and can be computed as:\n\n$$ \\text{FOL_RATIO_SFWD} = exp(-2.9584 + (-4.4766/(DIA)) $$\n\nfor softwood species and:\n\n$$ \\text{FOL_RATIO_HDWD} = exp(-4.0813 + (-5.8816/(DIA)) $$\n      \nfor hardwood species. The top and branch biomass can be calculated from subtracting all other components and multiplying by the structural loss adjustment for tops and limbs:                          \n\n$$T_{ODT} = (\\text{JENKINS_AG_TREE} - MST - (S_{ODSW} + S_{ODSB}) - \\\\ (\\text{JENKINS_AG_TREE} * \\text{FOL_RATIO})) * CRM_{AdjFac} * TOP_{SLA}$$\n       \n### Belowground (roots)       \n       \nThe belowground (coarse roots) ratio from the Jenkins et al. 2003 paper (their Table 6) can be computed for softwood species as:\n\n$$ \\text{ROOT_RATIO_SFWD} = exp(-1.5619 + (0.6614/(DIA)) $$\nand for hardwood species as:\n\n$$ \\text{ROOT_RATIO_HDWD} = exp(-1.6911 + (0.8160/(DIA)) $$       \n   \nBelowground biomass ($BG_{ODT}$) can then be calculated as: \n \n$$BG_{ODT} = (\\text{ROOT_RATIO} \\times \\text{JENKINS_AG_tree}) \\\\ \\times CRM_{AdjFac} \\times ROOTS_{SLA}$$\n \n \n### Total standing dead tree biomass and carbon\n\nFinally, the total biomass of a standing dead tree, including aboveground and belowground components, can be calculated as:\n\n$$\\text{BIOMASS_TOTAL_SDT} = B_{ODT} + S_{ODT} + T_{ODT} + BG_{ODT}$$\n\nAnd we can multiply by 0.5, assuming half of biomass is carbon, to compute total carbon in a standing dead tree:  \n\n$$\\text{CARBON_TOTAL_SDT} = \\text{BIOMASS_TOTAL_SDT} \\times 0.5$$\n\n\n\n \n## R functions to determine standing dead tree biomass and carbon     \nThe R functions that calculate these values are written below:\n\n```{r}\n# Stem wood biomass\nfx_B_ODW <- function(VOL, WOOD_SPGR_GREENVOL_DRYWT, W, \n                    STANDING_DEAD_DECAY_RATIO, BOLE_SLA){\n  B_ODW = VOL*WOOD_SPGR_GREENVOL_DRYWT*W*STANDING_DEAD_DECAY_RATIO*BOLE_SLA\n  return(B_ODW)\n}\n\n# Bark biomass\nfx_B_ODB <- function(VOL, BARK_VOL_PCT, W, BARK_SPGR_GREENVOL_DRYWT,\n                    STANDING_DEAD_DECAY_RATIO, BARK_SLA){\n  B_ODB = VOL*(BARK_VOL_PCT/100)*BARK_SPGR_GREENVOL_DRYWT*1000*\n    STANDING_DEAD_DECAY_RATIO*BARK_SLA\n  return(B_ODB)\n}\n\n# Total SDT biomass (stem wood and bark)\nfx_B_ODT <- function(B_ODW, B_ODB){\n  B_ODT = B_ODW + B_ODB\n  return(B_ODT)\n}\n\n# Jenkins aboveground biomass\nfx_JENKINS_AG_TREE <- function(JENKINS_TOTAL_B1, JENKINS_TOTAL_B2, DIA){\n  JENKINS_AG_TREE = exp(JENKINS_TOTAL_B1 + JENKINS_TOTAL_B2*log(DIA))\n  return(JENKINS_AG_TREE)\n}\n\n# Bole ratio\nfx_BOLE_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-0.3737; b =-1.8055}\n  else if(SFTWD_HRDWD == \"H\"){a=-0.3065; b =-5.4240}\n  BOLE_RATIO = exp(a + (b/(DIA)))\n  return(BOLE_RATIO)\n}\n\n# Bark ratio\nfx_BARK_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-2.0980; b =-1.1432}\n  else if(SFTWD_HRDWD == \"H\"){a=-2.0129; b =-1.6805}\n  BOLE_RATIO = exp(a + (b/(DIA)))\n  return(BOLE_RATIO)\n}\n\n# Merchantable oven-dry biomass\nfx_MST = function(JENKINS_AG_TREE, BOLE_RATIO, BARK_RATIO){\n  MST = (JENKINS_AG_TREE * BOLE_RATIO) + (JENKINS_AG_TREE * BARK_RATIO)\n  return(MST)\n}\n\n# Component ratio adjustment factor\nfx_CRM_AdjFac = function(B_ODT, MST){\n  CRM_AdjFac = B_ODT/MST\n  return(CRM_AdjFac)\n}\n\n# Stump volume outside bark,\n\nfx_STUMP_VOSB <- function(DIA, RAILE_STUMP_DOB_B1){\n  STUMP_VOSB = (3.14159265*((DIA)**2))/(4*144)*(((1-RAILE_STUMP_DOB_B1)**2*1+11*\n                RAILE_STUMP_DOB_B1*(1-RAILE_STUMP_DOB_B1)*log(1+1)-30.25/(1+1)* \n                  RAILE_STUMP_DOB_B1**2)-((1-RAILE_STUMP_DOB_B1)**2*0+11*\n                                            RAILE_STUMP_DOB_B1*(1-RAILE_STUMP_DOB_B1)*\n                                            log(0+1)-30.25/(0+1)*RAILE_STUMP_DOB_B1**2))*0.0283168\n   return(STUMP_VOSB)\n} \n  \n# Stump volume inside bark\nfx_STUMP_VISB <- function(DIA, RAILE_STUMP_DIB_B1, RAILE_STUMP_DIB_B2){\n  STUMP_VISB = (3.14159265*((DIA)**2))/(4*144)*(((RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)**2*1+11*\n                 RAILE_STUMP_DIB_B2*(RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)* log(1+1)-30.25/(1+1)*             \n                   RAILE_STUMP_DIB_B2**2)-((RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)**2*0+11*                                                            RAILE_STUMP_DIB_B2*(RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)*\n                                             log(0+1)-30.25/(0+1)*RAILE_STUMP_DIB_B2**2))*0.0283168\n   return(STUMP_VISB)\n} \n   \n# Stump wood biomass\nfx_S_ODSW <- function(STUMP_VISB, WOOD_SPGR_GREENVOL_DRYWT, W){\n  S_ODSW = STUMP_VISB*WOOD_SPGR_GREENVOL_DRYWT*W\n  return(S_ODSW)\n}\n  \n# Stump bark biomass\nfx_S_ODSB <- function(STUMP_VOSB, STUMP_VISB, BARK_SPGR_GREENVOL_DRYWT, W){\n  S_ODSB = (STUMP_VOSB - STUMP_VISB)*BARK_SPGR_GREENVOL_DRYWT*W\n  return(S_ODSB)\n}\n\n# Total stump biomass:\nfx_S_ODT <- function(S_ODSW, S_ODSB, CRM_AdjFac, STUMP_SLA){\n  S_ODT = (S_ODSW + S_ODSB)*CRM_AdjFac*STUMP_SLA\n}\n\n# Foliage ratio\nfx_FOL_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-2.9584; b =-4.4766}\n  else if(SFTWD_HRDWD == \"H\"){a=-4.0813; b =-5.8816}\n  FOL_RATIO = exp(a + (b/(DIA)))\n  return(FOL_RATIO)\n}\n\n# Top and branch biomass\nfx_T_ODT <- function(JENKINS_AG_TREE, MST, S_ODSW, S_ODSB,\n                    FOL_RATIO, CRM_AdjFac, TOP_SLA){\n  T_ODT = (JENKINS_AG_TREE - MST - (S_ODSW + S_ODSB) - \n             (JENKINS_AG_TREE * FOL_RATIO)) * CRM_AdjFac * TOP_SLA\n  return(T_ODT)\n}\n\n# Coarse root ratio\nfx_ROOT_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-1.5619; b =0.6614}\n  else if(SFTWD_HRDWD == \"H\"){a=-1.6911; b =0.8160}\n  ROOT_RATIO = exp(a + (b/(DIA)))\n  return(ROOT_RATIO)\n}\n      \n# Belowground biomass\nfx_ROOT_ODT <- function(ROOT_RATIO, JENKINS_AG_TREE, CRM_AdjFac, ROOTS_SLA){\n  ROOT_ODT = (ROOT_RATIO*JENKINS_AG_TREE) * CRM_AdjFac * ROOTS_SLA\nreturn(ROOT_ODT)\n}\n\n# Total biomass\nfx_BIOMASS_TOTAL_SDT <- function(B_ODT, S_ODT, T_ODT, ROOT_ODT){\n  BIOMASS_TOTAL_SDT = B_ODT + S_ODT + T_ODT + ROOT_ODT\nreturn(BIOMASS_TOTAL_SDT)\n}\n\n# Total carbon\nfx_CARBON_TOTAL_SDT <- function(BIOMASS_TOTAL_SDT){\n  CARBON_TOTAL_SDT = BIOMASS_TOTAL_SDT * 0.5\nreturn(CARBON_TOTAL_SDT)\n}\n      \n```\n\nNow, we'll apply the SDT functions to the `tree` data set. Note we'll need to convert the volume from cubic feet to cubic meters by multiplying by 0.0283168, and change the diameter from inches/centimeters where needed:\n\n```{r}\ntree <- tree %>% \n  mutate(B_ODW = mapply(fx_B_ODW, \n                        VOL = VOL*0.0283168, \n                        WOOD_SPGR_GREENVOL_DRYWT = WOOD_SPGR_GREENVOL_DRYWT, \n                        W = 1000, \n                        STANDING_DEAD_DECAY_RATIO = STANDING_DEAD_DECAY_RATIO, \n                        BOLE_SLA = BOLE_SLA),\n         B_ODB = mapply(fx_B_ODB,\n                        VOL = (VOL*0.0283168),\n                        BARK_VOL_PCT = BARK_VOL_PCT,\n                        BARK_SPGR_GREENVOL_DRYWT = BARK_SPGR_GREENVOL_DRYWT,\n                        W = 1000,\n                        STANDING_DEAD_DECAY_RATIO = STANDING_DEAD_DECAY_RATIO,\n                        BARK_SLA = BARK_SLA),\n         B_ODT = mapply(fx_B_ODT, \n                        B_ODW = B_ODW,\n                        B_ODB = B_ODB),\n         JENKINS_AG_TREE = mapply(fx_JENKINS_AG_TREE,\n                                  JENKINS_TOTAL_B1 = JENKINS_TOTAL_B1, \n                                  JENKINS_TOTAL_B2 = JENKINS_TOTAL_B2, \n                                  DIA = DIA*2.54),\n          BOLE_RATIO = mapply(fx_BOLE_RATIO, \n                              SFTWD_HRDWD = SFTWD_HRDWD, \n                              DIA = DIA*2.54),\n         BARK_RATIO = mapply(fx_BARK_RATIO, \n                             SFTWD_HRDWD = SFTWD_HRDWD, \n                             DIA = DIA*2.54),\n         MST = mapply(fx_MST,\n                      JENKINS_AG_TREE = JENKINS_AG_TREE,\n                      BOLE_RATIO = BOLE_RATIO,\n                      BARK_RATIO = BARK_RATIO),\n         CRM_AdjFac = mapply(fx_CRM_AdjFac,\n                             B_ODT = B_ODT,\n                             MST = MST),\n         STUMP_VOSB = mapply(fx_STUMP_VOSB,\n                             DIA = DIA,\n                             RAILE_STUMP_DOB_B1 = RAILE_STUMP_DOB_B1),\n         STUMP_VISB = mapply(fx_STUMP_VISB,\n                             DIA = DIA,\n                             RAILE_STUMP_DIB_B1 = RAILE_STUMP_DIB_B1,\n                             RAILE_STUMP_DIB_B2 = RAILE_STUMP_DIB_B2),\n         S_ODSW = mapply(fx_S_ODSW,\n                          STUMP_VISB = STUMP_VISB,\n                          WOOD_SPGR_GREENVOL_DRYWT = WOOD_SPGR_GREENVOL_DRYWT,\n                          W = 1000),\n         S_ODSB = mapply(fx_S_ODSB,\n                         STUMP_VOSB = STUMP_VOSB,\n                         STUMP_VISB = STUMP_VISB,\n                         BARK_SPGR_GREENVOL_DRYWT = BARK_SPGR_GREENVOL_DRYWT,\n                         W = 1000),\n         S_ODT = mapply(fx_S_ODT,\n                        S_ODSW = S_ODSW,\n                        S_ODSB = S_ODSB,\n                        CRM_AdjFac = CRM_AdjFac,\n                        STUMP_SLA = STUMP_SLA),\n         FOL_RATIO = mapply(fx_FOL_RATIO,\n                            SFTWD_HRDWD = SFTWD_HRDWD, \n                            DIA = DIA*2.54),\n         T_ODT = mapply(fx_T_ODT,\n                        JENKINS_AG_TREE = JENKINS_AG_TREE,\n                        MST = MST,\n                        S_ODSW = S_ODSW,\n                        S_ODSB = S_ODSB,\n                        FOL_RATIO = FOL_RATIO,\n                        CRM_AdjFac = CRM_AdjFac,\n                        TOP_SLA = TOP_SLA),\n         ROOT_RATIO = mapply(fx_ROOT_RATIO,\n                            SFTWD_HRDWD = SFTWD_HRDWD, \n                            DIA = DIA*2.54),\n         ROOT_ODT = mapply(fx_ROOT_ODT,\n                           ROOT_RATIO = ROOT_RATIO, \n                           JENKINS_AG_TREE = JENKINS_AG_TREE, \n                           CRM_AdjFac = CRM_AdjFac, \n                           ROOTS_SLA = ROOTS_SLA),\n         BIOMASS_TOTAL_SDT = mapply(fx_BIOMASS_TOTAL_SDT,\n                                    B_ODT = B_ODT,\n                                    S_ODT = S_ODT,\n                                    T_ODT = T_ODT,\n                                    ROOT_ODT = ROOT_ODT),\n         CARBON_TOTAL_SDT = mapply(fx_CARBON_TOTAL_SDT,\n                                   BIOMASS_TOTAL_SDT = BIOMASS_TOTAL_SDT))\n```\n\nNow we can plot the diameter-carbon trends, and we end up with a graph that looks similar to to the volume-diameter trends from before:\n\n```{r}\nggplot(tree, aes(x = DIA, y = CARBON_TOTAL_SDT*2.20462, col = factor(SPCD))) +\n  geom_point() +\n  labs(x = \"Diameter (in.)\",\n       y = \"Total carbon (pounds)\")\n```\n\nWe may be interested in a plot-level summary of SDT carbon. The code below summarizes the per-acre values of SDT carbon, by converting to pounds and multiplying by the tree's expansion factor (In the FIA data, one tree sampled represents approximately six trees sampled on a per acre basis): \n\n```{r, warning=F, message=F}\ndead_sum <- tree %>% \n  mutate(CARBON_TOTAL_SDT_part = CARBON_TOTAL_SDT*2.20462*6.018046) %>% \n  group_by(STATECD, COUNTYCD, PLOT) %>% \n  summarize(CARBON_TOTAL_SDT_lbs_ac = sum(CARBON_TOTAL_SDT_part))\n```\n\nAs we can see, we have anywhere between 0.2 and 0.7 tons per acre of standing dead tree carbon from these four inventory plots:\n\n```{r}\nggplot(dead_sum, aes(x = factor(PLOT), y = CARBON_TOTAL_SDT_lbs_ac/2000)) +\n  geom_bar(stat = \"identity\") +\n  labs(x = \"PLOT ID\",\n       y = \"Total carbon (tons/ac)\")\n```\n\n## Other notes \n\nA few other notes about determining the biomass and carbon in standing dead trees:\n\n* Depending on the data collected on the SDTs from your inventory, there may also be measurements such as whether or not the stem is **cull or rotten**. After all, these characteristics are likely if the tree is dead. Some deductions in volume can be taken at the start before determining biomass and carbon. \n* The selection of **which volume equation to use** has a large influence on the amount of carbon. If using FIA data, the `VOLCFSND` variable is the one that's used in the component ratio method. These are regionally specific equations that use either height or site index. If **taper equations** are available for your area, consider using those given the variability in heights (e.g., broken limbs) on standing dead trees. That's an approach I applied [on some SDT data in Maine](https://www.sciencedirect.com/science/article/pii/S0378112712004793). (At least the peer reviewers didn't complain.)\n* Some inventories, like FIA's, collect a height measurement that assumes the tree has it's top and limbs intact (e.g., the `HT` variable in FIA) and a **true height** (e.g., the `ACTUALHT` variable in FIA). When computing volume, biomass, and carbon of SDTs a true actual height is a better representation because it would incorporate broken stems. \n* These data and equations use a five-class **decay class system**. This approach can be adapted by refining the decay ratios and structural loss adjustments for trees in the region you work in.\n* The approach outlined here is similar to estimating the biomass and carbon in **live trees**. It's the regional volume equations that are more complex and vary across the US.\n* These approaches often calculate terms in mixed English and metric units. See the [Forest Carbon Cheat Sheet](https://arbor-analytics.com/post/2022-12-21-forest-carbon-cheat-sheet-updated-for-2022/) for a handy list on common units and conversion factors. \n* The USDA Forest Service will soon release [**updated equations**](https://www.fs.usda.gov/research/research/inventory/FIA/VBC) for determining volume, biomass, and carbon of trees. No doubt this will also influence the calculation of standing dead trees. \n\n-- \n\n*By Matt Russell. Sign up for my [monthly newsletter](https://mailchi.mp/d96897dc0f46/arbor-analytics) for in-depth analysis on data and analytics in the forest products industry.*\n","srcMarkdownNoYaml":"\n\n<center>\n\n![](balsam fir snag Maine.jpg){width=400px}\n\n</center>\n\n\n<center>\n*A standing dead balsam fir tree in Maine.*\n</center>\n\n##\n\nQuantifying the presence and abundance of standing dead trees (SDTs) is notoriously difficult. While live and healthy trees generally appear similar in form and appearance to other live and healthy trees, no two standing dead trees are alike. \n\nTrees that recently died within a few months can have most of their tops and limbs intact. Their foliage may even still be attached. Trees that have been standing dead for a decade or more can only have a portion of the bole remaining with the rest already decaying on the forest floor.   \n\nThese attributes make quantifying the carbon found within SDTs incredibly complex. The popular [Jenkins biomass equations](https://www.fs.usda.gov/research/treesearch/6996) were developed for live trees, and cannot be applied to SDTs directly.  If you're only using common forest inventory measurements like species and diameter, there's really no way to quantify the difference in the amount of carbon in a tree that recently died to one that has been standing dead for decades. \n\nFortunately, most inventories that measure dead wood will collect data on the stage of decay of SDTs. These data are needed to refine estimates of SDT biomass and carbon by including structural loss and decay adjustments.\n\nIn this post I implement a method for quantifying the amount of carbon in standing dead trees using R, drawing especially from functions in the **tidyverse** package. The approach presented here follows the component ratio method approach for determining carbon developed by the USDA Forest Service. A few key resources that go through the methods of this approach:\n\n* [*Accounting for density reduction and structural loss in standing dead trees: implications for forest biomass and carbon stock estimates in the United States*](https://cbmjournal.biomedcentral.com/articles/10.1186/1750-0680-6-14) by Domke et al. 2011. This paper describes the method and how it impacts the Forest Inventory and Analysis data.\n* [Additional file 1 from the paper (PDF).](https://static-content.springer.com/esm/art%3A10.1186%2F1750-0680-6-14/MediaObjects/13021_2011_72_MOESM1_ESM.PDF) The supplemental file presents equations the equations used estimate above and belowground SDT biomass and carbon and provides an example calculation.\n\n## Standing dead tree data\n\nI compiled a few records of standing dead trees from four Forest Inventory and Analysis plots located in Maine. The four plots were measured in 2021 and the data set contains 10 SDTs. Here is the data that can be read into R with the `tribble()` function from the **tidyverse** package:\n\n```{r, warning = FALSE, message = FALSE}\nlibrary(tidyverse)\n```\n\n```{r}\ntree <- tribble(\n  ~STATECD, ~COUNTYCD, ~PLOT, ~TREE, ~SPCD, ~DIA, ~ACTUALHT, ~DECAYCD,\n  23, 29, 130, 6, 95, 6.7, 27, 3,\n  23, 29, 130, 9, 95, 5.6, 9, 2,\n  23, 29, 688, 1, 12, 7.9, 35, 1,\n  23, 29, 688, 6, 12, 8.6, 31, 1,\n  23, 29, 701, 1, 371, 11, 17, 5,\n  23, 29, 701, 6, 531, 5.5, 49, 1,\n  23, 29, 846, 8, 241, 13.6, 26, 2,\n  23, 29, 846, 12, 12, 6.2, 10, 4,\n  23, 29, 846, 17, 12, 6.8, 5, 4,\n  23, 29, 846, 23, 12, 5.1, 29, 2,\n)\n```\n\nThe variables are:\n\n* `STATECD`: Numeric state ID code (23 = Maine), \n* `COUNTYCD`: Numeric county ID code (29 = Washington County),  \n* `PLOT`: Numeric plot ID code,  \n* `TREE`: Numeric tree ID code,  \n* `SPCD`: Numeric FIA tree species code,  \n* `DIA`: Tree diameter (inches), \n* `ACTUALHT`: Height of the tree (feet), from ground level to the highest remaining portion of the tree, \n* `DECAYCD`: Numeric code indicating the stage of decay in a standing dead tree; ranges from 1 (all limbs and branches are present) to 5 (no evidence of branches remains; top is broken) \n\n\n## Calculating volume, biomass and carbon in standing dead trees\n### Tree volume\nThe first step to calculating the amount of carbon stored in SDTs is to determine their volume. In your region, there are likely regional volume equations that are used for the species you're interested in. For this example, I'll use [equations developed by Honer in 1967](http://ifmlab.for.unb.ca/People/Kershaw/Courses/For1001/Honer.html) which are widely used for commercial species in the northeastern US and Canada.\n\nThe Honer equations predict volume in cubic feet and rely on species, diameter at breast height (`DBH`; measured in inches) and total tree height (`HT`; measured in feet):\n\n$$ VOL = \\frac{DBH^2}{a = \\frac{b}{HT}}$$\nwhere `a` and `b` are species-specific coefficients. \n\nHere is an R function to determine the volumes of the five species of SDTs in the data set:\n\n```{r}\nfx_HONER_VOL <- function(SPCD, DBH, HT){\n       if(SPCD == 12){a = 2.139; b = 301.634}   # balsam fir\n  else if(SPCD == 95){a = 1.588; b = 333.364}   # black spruce\n  else if(SPCD == 241){a = 4.167; b = 244.906}  # northern white-cedar\n  else if(SPCD == 371){a = 1.449; b = 344.754}  # yellow birch\n  else if(SPCD == 531){a = 0.959; b = 334.829}  # American beech\n  VOL = DBH**2/(a+(b/HT))\n  return(VOL)\n  }\n```\n\nNow, we can estimate the total volume of SDTs by applying the function to the `tree` data set. I use the `mutate()` function along with `mapply()` to create the new variable `VOL`:\n\n```{r}\ntree <- tree %>% \n  mutate(VOL = mapply(fx_HONER_VOL, SPCD = SPCD, DBH = DIA, HT = ACTUALHT))\n```\n\nA graph of the tree diameter-volume trends highlights the data. Note that because many of the SDTs may have a broken top, trees can be a large diameter with relatively small volume, which adds some \"noise\" to the relationship:\n\n```{r}\nggplot(tree, aes(x = DIA, y = VOL, col = factor(SPCD))) +\n  geom_point() +\n  labs(x = \"Diameter (in.)\",\n       y = \"Volume (cu.ft.)\")\n```\n\n### Species data\nTo determine biomass and carbon attributes of dead trees, the **species reference data set** (`REF_SPECIES.csv`) provided by the FIA program is a must. This file contains species-specific values of wood density, decay ratios, and more. We'll read the .csv file in from the USDA website, then select the core variables needed to determine biomass and carbon for SDTs:\n\n```{r, warning=F, message=F}\nref_spp <- read_csv(\"C://Users//matt//Documents//Arbor//Projects//FFCP//Central Apps v1//Data//REF_SPECIES.csv\") %>% \n  select(SPCD, WOOD_SPGR_GREENVOL_DRYWT, BARK_SPGR_GREENVOL_DRYWT, BARK_VOL_PCT,\n         WOOD_SPGR_MC12VOL_DRYWT, SFTWD_HRDWD, JENKINS_TOTAL_B1,JENKINS_TOTAL_B2,\n         STANDING_DEAD_DECAY_RATIO1, STANDING_DEAD_DECAY_RATIO2, \n         STANDING_DEAD_DECAY_RATIO3,\n         STANDING_DEAD_DECAY_RATIO4, STANDING_DEAD_DECAY_RATIO5,\n         RAILE_STUMP_DOB_B1, RAILE_STUMP_DIB_B1, RAILE_STUMP_DIB_B2)\n```\n\nNext, we'll join the `ref_spp` data set to the `tree` data set:\n\n```{r}\ntree <- inner_join(tree, ref_spp, by = \"SPCD\")\n```\n\nNow, we'll modify some of the species-specific factors from the reference species table. The `STANDING_DEAD_DECAY_RATIO` variable contains the ratio of decayed wood density to non-decayed wood density. It's stored in five different variables for each of the five different decay classes, so the code below will turn it into a data set organized in a long format:\n\n```{r}\nref_spp_dead <- ref_spp %>% \n  select(SPCD, STANDING_DEAD_DECAY_RATIO1, STANDING_DEAD_DECAY_RATIO2, \n         STANDING_DEAD_DECAY_RATIO3, STANDING_DEAD_DECAY_RATIO4, \n         STANDING_DEAD_DECAY_RATIO5) %>% \n  pivot_longer(STANDING_DEAD_DECAY_RATIO1:STANDING_DEAD_DECAY_RATIO5, \n               names_to = \"DECAY_NAME\", \n               values_to = \"STANDING_DEAD_DECAY_RATIO\") %>% \n  mutate(DECAYCD = as.numeric(str_sub(DECAY_NAME, 26, 26))) %>% \n  select(-DECAY_NAME) %>% \n  relocate(SPCD, DECAYCD, STANDING_DEAD_DECAY_RATIO)\n```\n\nFor example, here are the decay ratios for standing dead trees for the five decay classes for balsam fir:\n\n```{r}\nprint(ref_spp_dead[ref_spp_dead$SPCD == 12, ])\n```\n\n### Structural loss adjustments\nWhile decay ratios account for decay and decomposition of wood, they don't account for structural losses. Standing dead trees experience  sloughing and breakage as a result of wind damage, animal activity, and many more issues. For this, structural loss adjustments are needed to accurately determine the biomass and carbon stored in SDTs.  \n\nThe structural loss adjustments can be obtained in [Table 2 of the Domke et al. paper](https://cbmjournal.biomedcentral.com/articles/10.1186/1750-0680-6-14/tables/2). These decay-class-specific adjustments are for the bole, bark, tops and limbs, stumps, and roots. The table `sla` produces these values. We can then merge the `sla` table with the `ref_spp_dead` table, then merge that to the `tree` table:\n\n```{r}\nsla <- tribble(\n  ~DECAYCD, ~BOLE_SLA, ~BARK_SLA, ~TOP_SLA, ~STUMP_SLA, ~ROOTS_SLA,\n  1, 1, 0.92, 1, 1, 1,\n  2, 1, 0.66, 0.5, 1, 0.95,\n  3, 1, 0.39, 0.20, 1, 0.80,\n  4, 1, 0.21, 0.10, 1, 0.65,\n  5, 1, 0, 0, 1, 0.50)\n\nref_spp_dead <- left_join(ref_spp_dead, sla, by = \"DECAYCD\")\n\ntree <- left_join(tree, ref_spp_dead, by = c(\"SPCD\", \"DECAYCD\")) \n```\n\nPhew! That was a lot of work and we haven't even begun to calculate biomass yet. No fear, now we have all of the variables required in the `tree` data set to begin the biomass and carbon calculations.\n\n## Determing component biomass in standing dead trees\n### Stem and bark \n\nWe start by calculating the biomass in wood found the the stem of the tree ($B_{ODW}$; kg). We will also need the specific gravity of wood for that species, i.e., the `WOOD_SPGR_GREENVOL_DRYWT` variable from the reference species file and `W`, the weight of one cubic meter of water (1,000 kg). The structural loss adjustment for the bole (`BOLE_SLA`) is multiplied by these values:\n$$B_{ODW} = VOL\\times \\text{WOOD_SPGR_GREENVOL_DRYWT}\\times \\\\ W \\times \\text{STANDING_DEAD_DECAY_RATIO}\\times \\text{BOLE_SLA}$$ \n\nThe biomass found in the bark of the tree is the next component to predict($B_{ODB}$; kg). For this we'll also need to know the species-specific values for the percent of wood volume that is bark (`BARK_VOL_PCT`), the specific gravity of bark (BARK_SPGR_GREENVOL_DRYWT), and the structural loss adjustment for the bark component (`BARK_SLA`):\n\n$$B_{ODB} = VOL\\times \\text{BARK_VOL_PCT/100}\\times \\text{BARK_SPGR_GREENVOL_DRYWT} \\times \\\\ W \\times \\text{STANDING_DEAD_DECAY_RATIO}\\times \\text{BARK_SLA}$$ \nTotal SDT bole and bark biomass ($B_{ODT}$) can be found by adding the two components:\n\n$$B_{ODT} = B_{ODW} + B_{ODB}$$ \n\nBecause this approach uses the component ratio method (CRM) to determine biomass stored in SDTs, the next step is to calculate the biomass in each SDT and them compute the ratios. First we need to calculate the bole biomass (kg) from the Jenkins et al. equation (`JENKINS_AG_TREE`). These equations have different parameters for 10 species groups:\n\n$$ \\text{JENKINS_AG_TREE} = exp(\\text{JENKINS_TOTAL_B1} + \\\\ \\text{JENKINS_TOTAL_B2}*log(DIA)) $$\nThe bole ratio from the Jenkins et al. 2003 paper (their Table 6) can be computed for softwood species as:\n\n$$ \\text{BOLE_RATIO_SFWD} = exp(-0.3737 + (-1.8055/(DIA)) $$\nand for hardwood species as:\n\n$$ \\text{BOLE_RATIO_HDWD} = exp(-0.3065 + (-5.4240/(DIA)) $$\n      \n\nRatios of bark can be computed for softwood species as:\n\n$$ \\text{BARK_RATIO_SFWD} = exp(-2.0980 + (-1.1432/(DIA)) $$\n\nand for hardwood species as:\n\n$$ \\text{BOLE_RATIO_HDWD} = exp(-2.0129 + (-5.4240/(DIA)) $$\nMerchantable oven-dry biomass (`MST`) is then calculated as:\n\n$$MST = (\\text{JENKINS_AG_TREE} * \\text{BOLE_RATIO}) + \\\\ (\\text{JENKINS_AG_TREE} * \\text{BARK_RATIO})$$\n\n\nThen, the CRM adjustment factor ($CRM_{AdjFac}$) for each SDT can be calculated as:\n\n$$ CRM_{AdjFac} = B_{ODT}/MST $$\n\n### Stumps\n\nVolume of stumps is calculated next. These equations are adopted from [Raile's equations](https://www.fs.usda.gov/research/treesearch/10745). Stump volume is calculated as:\n\n$$ S_{VOL} = (\\frac{\\pi*DIA^2}{4*144})[((A-B)^2h+11B(A-B)ln(h+1)- \\\\ (\\frac{30.25}{h+1}B^2)]_a^b)\\times0.02832 $$\n\nwhere:\n\n* `S_VOL` is stump volume inside bark ($S_{VISB}$) or outside bark ($S_{VOSB}$), \n* `A` and `B` are species-specific coefficients (`RAILE_STUMP_DOB_B1`, `RAILE_STUMP_DIB_B1`, and `RAILE_STUMP_DIB_B2`), \n* `h` is the height above ground (ft), \n* `a` is the lower stump height (ft; typically set to 0), and \n* `b` is the upper stump height (ft; typically set to one.\n\nThe biomass in the wood of stumps is calculated by multiplying the volume of stumps (inside bark) by the species specific gravity and the weight of water:\n\n$$S_{ODSW} = S_{VISB}\\times \\text{WOOD_SPGR_GREENVOL_DRYWT} \\times W$$\nA similar approach can be used for calculating the biomass in bark, this time subtracting the volume inside and outside the bark:\n\n$$S_{ODSB} = (S_{VOSB}-S_{VISB})\\times \\text{BARK_SPGR_GREENVOL_DRYWT} \\times W$$\nTotal biomass in the stump ($S_{ODT}$) can be calculated by applying the $CRM_{AdjFac}$ and the structural loss adjustment for the stump ($STUMP_{SLA}$):\n\n$$S_{ODT} = (S_{ODSW} + S_{ODSB}) \\times CRM_{AdjFac} \\times STUMP_{SLA}$$\n\n### Tops and limbs\nNext comes estimating the biomass in tops and limbs. Although foliage biomass is not calculated for SDTs, we calculate it to subtract it from total biomass. The foliage ratio is different for softwood and hardwood species and can be computed as:\n\n$$ \\text{FOL_RATIO_SFWD} = exp(-2.9584 + (-4.4766/(DIA)) $$\n\nfor softwood species and:\n\n$$ \\text{FOL_RATIO_HDWD} = exp(-4.0813 + (-5.8816/(DIA)) $$\n      \nfor hardwood species. The top and branch biomass can be calculated from subtracting all other components and multiplying by the structural loss adjustment for tops and limbs:                          \n\n$$T_{ODT} = (\\text{JENKINS_AG_TREE} - MST - (S_{ODSW} + S_{ODSB}) - \\\\ (\\text{JENKINS_AG_TREE} * \\text{FOL_RATIO})) * CRM_{AdjFac} * TOP_{SLA}$$\n       \n### Belowground (roots)       \n       \nThe belowground (coarse roots) ratio from the Jenkins et al. 2003 paper (their Table 6) can be computed for softwood species as:\n\n$$ \\text{ROOT_RATIO_SFWD} = exp(-1.5619 + (0.6614/(DIA)) $$\nand for hardwood species as:\n\n$$ \\text{ROOT_RATIO_HDWD} = exp(-1.6911 + (0.8160/(DIA)) $$       \n   \nBelowground biomass ($BG_{ODT}$) can then be calculated as: \n \n$$BG_{ODT} = (\\text{ROOT_RATIO} \\times \\text{JENKINS_AG_tree}) \\\\ \\times CRM_{AdjFac} \\times ROOTS_{SLA}$$\n \n \n### Total standing dead tree biomass and carbon\n\nFinally, the total biomass of a standing dead tree, including aboveground and belowground components, can be calculated as:\n\n$$\\text{BIOMASS_TOTAL_SDT} = B_{ODT} + S_{ODT} + T_{ODT} + BG_{ODT}$$\n\nAnd we can multiply by 0.5, assuming half of biomass is carbon, to compute total carbon in a standing dead tree:  \n\n$$\\text{CARBON_TOTAL_SDT} = \\text{BIOMASS_TOTAL_SDT} \\times 0.5$$\n\n\n\n \n## R functions to determine standing dead tree biomass and carbon     \nThe R functions that calculate these values are written below:\n\n```{r}\n# Stem wood biomass\nfx_B_ODW <- function(VOL, WOOD_SPGR_GREENVOL_DRYWT, W, \n                    STANDING_DEAD_DECAY_RATIO, BOLE_SLA){\n  B_ODW = VOL*WOOD_SPGR_GREENVOL_DRYWT*W*STANDING_DEAD_DECAY_RATIO*BOLE_SLA\n  return(B_ODW)\n}\n\n# Bark biomass\nfx_B_ODB <- function(VOL, BARK_VOL_PCT, W, BARK_SPGR_GREENVOL_DRYWT,\n                    STANDING_DEAD_DECAY_RATIO, BARK_SLA){\n  B_ODB = VOL*(BARK_VOL_PCT/100)*BARK_SPGR_GREENVOL_DRYWT*1000*\n    STANDING_DEAD_DECAY_RATIO*BARK_SLA\n  return(B_ODB)\n}\n\n# Total SDT biomass (stem wood and bark)\nfx_B_ODT <- function(B_ODW, B_ODB){\n  B_ODT = B_ODW + B_ODB\n  return(B_ODT)\n}\n\n# Jenkins aboveground biomass\nfx_JENKINS_AG_TREE <- function(JENKINS_TOTAL_B1, JENKINS_TOTAL_B2, DIA){\n  JENKINS_AG_TREE = exp(JENKINS_TOTAL_B1 + JENKINS_TOTAL_B2*log(DIA))\n  return(JENKINS_AG_TREE)\n}\n\n# Bole ratio\nfx_BOLE_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-0.3737; b =-1.8055}\n  else if(SFTWD_HRDWD == \"H\"){a=-0.3065; b =-5.4240}\n  BOLE_RATIO = exp(a + (b/(DIA)))\n  return(BOLE_RATIO)\n}\n\n# Bark ratio\nfx_BARK_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-2.0980; b =-1.1432}\n  else if(SFTWD_HRDWD == \"H\"){a=-2.0129; b =-1.6805}\n  BOLE_RATIO = exp(a + (b/(DIA)))\n  return(BOLE_RATIO)\n}\n\n# Merchantable oven-dry biomass\nfx_MST = function(JENKINS_AG_TREE, BOLE_RATIO, BARK_RATIO){\n  MST = (JENKINS_AG_TREE * BOLE_RATIO) + (JENKINS_AG_TREE * BARK_RATIO)\n  return(MST)\n}\n\n# Component ratio adjustment factor\nfx_CRM_AdjFac = function(B_ODT, MST){\n  CRM_AdjFac = B_ODT/MST\n  return(CRM_AdjFac)\n}\n\n# Stump volume outside bark,\n\nfx_STUMP_VOSB <- function(DIA, RAILE_STUMP_DOB_B1){\n  STUMP_VOSB = (3.14159265*((DIA)**2))/(4*144)*(((1-RAILE_STUMP_DOB_B1)**2*1+11*\n                RAILE_STUMP_DOB_B1*(1-RAILE_STUMP_DOB_B1)*log(1+1)-30.25/(1+1)* \n                  RAILE_STUMP_DOB_B1**2)-((1-RAILE_STUMP_DOB_B1)**2*0+11*\n                                            RAILE_STUMP_DOB_B1*(1-RAILE_STUMP_DOB_B1)*\n                                            log(0+1)-30.25/(0+1)*RAILE_STUMP_DOB_B1**2))*0.0283168\n   return(STUMP_VOSB)\n} \n  \n# Stump volume inside bark\nfx_STUMP_VISB <- function(DIA, RAILE_STUMP_DIB_B1, RAILE_STUMP_DIB_B2){\n  STUMP_VISB = (3.14159265*((DIA)**2))/(4*144)*(((RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)**2*1+11*\n                 RAILE_STUMP_DIB_B2*(RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)* log(1+1)-30.25/(1+1)*             \n                   RAILE_STUMP_DIB_B2**2)-((RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)**2*0+11*                                                            RAILE_STUMP_DIB_B2*(RAILE_STUMP_DIB_B1-RAILE_STUMP_DIB_B2)*\n                                             log(0+1)-30.25/(0+1)*RAILE_STUMP_DIB_B2**2))*0.0283168\n   return(STUMP_VISB)\n} \n   \n# Stump wood biomass\nfx_S_ODSW <- function(STUMP_VISB, WOOD_SPGR_GREENVOL_DRYWT, W){\n  S_ODSW = STUMP_VISB*WOOD_SPGR_GREENVOL_DRYWT*W\n  return(S_ODSW)\n}\n  \n# Stump bark biomass\nfx_S_ODSB <- function(STUMP_VOSB, STUMP_VISB, BARK_SPGR_GREENVOL_DRYWT, W){\n  S_ODSB = (STUMP_VOSB - STUMP_VISB)*BARK_SPGR_GREENVOL_DRYWT*W\n  return(S_ODSB)\n}\n\n# Total stump biomass:\nfx_S_ODT <- function(S_ODSW, S_ODSB, CRM_AdjFac, STUMP_SLA){\n  S_ODT = (S_ODSW + S_ODSB)*CRM_AdjFac*STUMP_SLA\n}\n\n# Foliage ratio\nfx_FOL_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-2.9584; b =-4.4766}\n  else if(SFTWD_HRDWD == \"H\"){a=-4.0813; b =-5.8816}\n  FOL_RATIO = exp(a + (b/(DIA)))\n  return(FOL_RATIO)\n}\n\n# Top and branch biomass\nfx_T_ODT <- function(JENKINS_AG_TREE, MST, S_ODSW, S_ODSB,\n                    FOL_RATIO, CRM_AdjFac, TOP_SLA){\n  T_ODT = (JENKINS_AG_TREE - MST - (S_ODSW + S_ODSB) - \n             (JENKINS_AG_TREE * FOL_RATIO)) * CRM_AdjFac * TOP_SLA\n  return(T_ODT)\n}\n\n# Coarse root ratio\nfx_ROOT_RATIO <- function(SFTWD_HRDWD, DIA){\n       if(SFTWD_HRDWD == \"S\"){a=-1.5619; b =0.6614}\n  else if(SFTWD_HRDWD == \"H\"){a=-1.6911; b =0.8160}\n  ROOT_RATIO = exp(a + (b/(DIA)))\n  return(ROOT_RATIO)\n}\n      \n# Belowground biomass\nfx_ROOT_ODT <- function(ROOT_RATIO, JENKINS_AG_TREE, CRM_AdjFac, ROOTS_SLA){\n  ROOT_ODT = (ROOT_RATIO*JENKINS_AG_TREE) * CRM_AdjFac * ROOTS_SLA\nreturn(ROOT_ODT)\n}\n\n# Total biomass\nfx_BIOMASS_TOTAL_SDT <- function(B_ODT, S_ODT, T_ODT, ROOT_ODT){\n  BIOMASS_TOTAL_SDT = B_ODT + S_ODT + T_ODT + ROOT_ODT\nreturn(BIOMASS_TOTAL_SDT)\n}\n\n# Total carbon\nfx_CARBON_TOTAL_SDT <- function(BIOMASS_TOTAL_SDT){\n  CARBON_TOTAL_SDT = BIOMASS_TOTAL_SDT * 0.5\nreturn(CARBON_TOTAL_SDT)\n}\n      \n```\n\nNow, we'll apply the SDT functions to the `tree` data set. Note we'll need to convert the volume from cubic feet to cubic meters by multiplying by 0.0283168, and change the diameter from inches/centimeters where needed:\n\n```{r}\ntree <- tree %>% \n  mutate(B_ODW = mapply(fx_B_ODW, \n                        VOL = VOL*0.0283168, \n                        WOOD_SPGR_GREENVOL_DRYWT = WOOD_SPGR_GREENVOL_DRYWT, \n                        W = 1000, \n                        STANDING_DEAD_DECAY_RATIO = STANDING_DEAD_DECAY_RATIO, \n                        BOLE_SLA = BOLE_SLA),\n         B_ODB = mapply(fx_B_ODB,\n                        VOL = (VOL*0.0283168),\n                        BARK_VOL_PCT = BARK_VOL_PCT,\n                        BARK_SPGR_GREENVOL_DRYWT = BARK_SPGR_GREENVOL_DRYWT,\n                        W = 1000,\n                        STANDING_DEAD_DECAY_RATIO = STANDING_DEAD_DECAY_RATIO,\n                        BARK_SLA = BARK_SLA),\n         B_ODT = mapply(fx_B_ODT, \n                        B_ODW = B_ODW,\n                        B_ODB = B_ODB),\n         JENKINS_AG_TREE = mapply(fx_JENKINS_AG_TREE,\n                                  JENKINS_TOTAL_B1 = JENKINS_TOTAL_B1, \n                                  JENKINS_TOTAL_B2 = JENKINS_TOTAL_B2, \n                                  DIA = DIA*2.54),\n          BOLE_RATIO = mapply(fx_BOLE_RATIO, \n                              SFTWD_HRDWD = SFTWD_HRDWD, \n                              DIA = DIA*2.54),\n         BARK_RATIO = mapply(fx_BARK_RATIO, \n                             SFTWD_HRDWD = SFTWD_HRDWD, \n                             DIA = DIA*2.54),\n         MST = mapply(fx_MST,\n                      JENKINS_AG_TREE = JENKINS_AG_TREE,\n                      BOLE_RATIO = BOLE_RATIO,\n                      BARK_RATIO = BARK_RATIO),\n         CRM_AdjFac = mapply(fx_CRM_AdjFac,\n                             B_ODT = B_ODT,\n                             MST = MST),\n         STUMP_VOSB = mapply(fx_STUMP_VOSB,\n                             DIA = DIA,\n                             RAILE_STUMP_DOB_B1 = RAILE_STUMP_DOB_B1),\n         STUMP_VISB = mapply(fx_STUMP_VISB,\n                             DIA = DIA,\n                             RAILE_STUMP_DIB_B1 = RAILE_STUMP_DIB_B1,\n                             RAILE_STUMP_DIB_B2 = RAILE_STUMP_DIB_B2),\n         S_ODSW = mapply(fx_S_ODSW,\n                          STUMP_VISB = STUMP_VISB,\n                          WOOD_SPGR_GREENVOL_DRYWT = WOOD_SPGR_GREENVOL_DRYWT,\n                          W = 1000),\n         S_ODSB = mapply(fx_S_ODSB,\n                         STUMP_VOSB = STUMP_VOSB,\n                         STUMP_VISB = STUMP_VISB,\n                         BARK_SPGR_GREENVOL_DRYWT = BARK_SPGR_GREENVOL_DRYWT,\n                         W = 1000),\n         S_ODT = mapply(fx_S_ODT,\n                        S_ODSW = S_ODSW,\n                        S_ODSB = S_ODSB,\n                        CRM_AdjFac = CRM_AdjFac,\n                        STUMP_SLA = STUMP_SLA),\n         FOL_RATIO = mapply(fx_FOL_RATIO,\n                            SFTWD_HRDWD = SFTWD_HRDWD, \n                            DIA = DIA*2.54),\n         T_ODT = mapply(fx_T_ODT,\n                        JENKINS_AG_TREE = JENKINS_AG_TREE,\n                        MST = MST,\n                        S_ODSW = S_ODSW,\n                        S_ODSB = S_ODSB,\n                        FOL_RATIO = FOL_RATIO,\n                        CRM_AdjFac = CRM_AdjFac,\n                        TOP_SLA = TOP_SLA),\n         ROOT_RATIO = mapply(fx_ROOT_RATIO,\n                            SFTWD_HRDWD = SFTWD_HRDWD, \n                            DIA = DIA*2.54),\n         ROOT_ODT = mapply(fx_ROOT_ODT,\n                           ROOT_RATIO = ROOT_RATIO, \n                           JENKINS_AG_TREE = JENKINS_AG_TREE, \n                           CRM_AdjFac = CRM_AdjFac, \n                           ROOTS_SLA = ROOTS_SLA),\n         BIOMASS_TOTAL_SDT = mapply(fx_BIOMASS_TOTAL_SDT,\n                                    B_ODT = B_ODT,\n                                    S_ODT = S_ODT,\n                                    T_ODT = T_ODT,\n                                    ROOT_ODT = ROOT_ODT),\n         CARBON_TOTAL_SDT = mapply(fx_CARBON_TOTAL_SDT,\n                                   BIOMASS_TOTAL_SDT = BIOMASS_TOTAL_SDT))\n```\n\nNow we can plot the diameter-carbon trends, and we end up with a graph that looks similar to to the volume-diameter trends from before:\n\n```{r}\nggplot(tree, aes(x = DIA, y = CARBON_TOTAL_SDT*2.20462, col = factor(SPCD))) +\n  geom_point() +\n  labs(x = \"Diameter (in.)\",\n       y = \"Total carbon (pounds)\")\n```\n\nWe may be interested in a plot-level summary of SDT carbon. The code below summarizes the per-acre values of SDT carbon, by converting to pounds and multiplying by the tree's expansion factor (In the FIA data, one tree sampled represents approximately six trees sampled on a per acre basis): \n\n```{r, warning=F, message=F}\ndead_sum <- tree %>% \n  mutate(CARBON_TOTAL_SDT_part = CARBON_TOTAL_SDT*2.20462*6.018046) %>% \n  group_by(STATECD, COUNTYCD, PLOT) %>% \n  summarize(CARBON_TOTAL_SDT_lbs_ac = sum(CARBON_TOTAL_SDT_part))\n```\n\nAs we can see, we have anywhere between 0.2 and 0.7 tons per acre of standing dead tree carbon from these four inventory plots:\n\n```{r}\nggplot(dead_sum, aes(x = factor(PLOT), y = CARBON_TOTAL_SDT_lbs_ac/2000)) +\n  geom_bar(stat = \"identity\") +\n  labs(x = \"PLOT ID\",\n       y = \"Total carbon (tons/ac)\")\n```\n\n## Other notes \n\nA few other notes about determining the biomass and carbon in standing dead trees:\n\n* Depending on the data collected on the SDTs from your inventory, there may also be measurements such as whether or not the stem is **cull or rotten**. After all, these characteristics are likely if the tree is dead. Some deductions in volume can be taken at the start before determining biomass and carbon. \n* The selection of **which volume equation to use** has a large influence on the amount of carbon. If using FIA data, the `VOLCFSND` variable is the one that's used in the component ratio method. These are regionally specific equations that use either height or site index. If **taper equations** are available for your area, consider using those given the variability in heights (e.g., broken limbs) on standing dead trees. That's an approach I applied [on some SDT data in Maine](https://www.sciencedirect.com/science/article/pii/S0378112712004793). (At least the peer reviewers didn't complain.)\n* Some inventories, like FIA's, collect a height measurement that assumes the tree has it's top and limbs intact (e.g., the `HT` variable in FIA) and a **true height** (e.g., the `ACTUALHT` variable in FIA). When computing volume, biomass, and carbon of SDTs a true actual height is a better representation because it would incorporate broken stems. \n* These data and equations use a five-class **decay class system**. This approach can be adapted by refining the decay ratios and structural loss adjustments for trees in the region you work in.\n* The approach outlined here is similar to estimating the biomass and carbon in **live trees**. It's the regional volume equations that are more complex and vary across the US.\n* These approaches often calculate terms in mixed English and metric units. See the [Forest Carbon Cheat Sheet](https://arbor-analytics.com/post/2022-12-21-forest-carbon-cheat-sheet-updated-for-2022/) for a handy list on common units and conversion factors. \n* The USDA Forest Service will soon release [**updated equations**](https://www.fs.usda.gov/research/research/inventory/FIA/VBC) for determining volume, biomass, and carbon of trees. No doubt this will also influence the calculation of standing dead trees. \n\n-- \n\n*By Matt Russell. Sign up for my [monthly newsletter](https://mailchi.mp/d96897dc0f46/arbor-analytics) for in-depth analysis on data and analytics in the forest products industry.*\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","theme":{"light":"minty","dark":"slate"},"title-block-banner":true,"title":"Calculating carbon in standing dead trees","author":"Matt Russell","date":"2023-02-10","slug":[],"categories":["Forest carbon"],"tags":["analytics","forest carbon","carbon accounting"]},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}