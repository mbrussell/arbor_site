{"title":"A handy R function for getting ecological division from FIA data","markdown":{"yaml":{"title":"A handy R function for getting ecological division from FIA data","description":"Some functions from the R's stringr package to obtain ecological division.","author":"Matt Russell","date":"2023-11-18","slug":[],"categories":[],"tags":["data management","forest carbon","forest inventory and analysis","forest inventory","ecodivision"],"image":"main_ecosections.png"},"headingText":"Set working directory","containsRefs":false,"markdown":"\n\n\n<center>\n\n![*Ecological sections and subsections in Maine, USA (from Cleland et al. 2007).*](main_ecosections.png){width=500px}\n</center>\n##\n\nTo get a better feel for how they work, I've been digging into the new [tree volume, biomass, and carbon models](https://www.fs.usda.gov/research/programs/fia/nsvb) released by the USDA Forest Service last month. These new equations replace volume equations developed at the regional level and are now nationally-consistent. Importantly for anyone that works with forest carbon inventory data, these new equations replace the Component Ratio Method (CRM).\n\nAlthough the equations replace regional ones previously implemented, they do require a geographical variable not widely used in forest biomass and carbon equations: ecological division. These divisions are outlined in the US National Hierarchical Framework of Ecological Units, described in detail in a map produced by [Cleland and others](https://www.fs.usda.gov/research/treesearch/48672) in 2007. Within divisions there are ecological provinces. Within those provinces there are ecological sections and subsections. \n\nIf you're doing an analysis on an individual ownership, you can simply look up the property's ecological division and find the equations for the tree species that you need. But if you're doing an analysis at a larger scale, e.g., across a US state, there may exist multiple ecological divisions within your project area. Ecological divisions don't line up with regional, state, or county boundaries, making it tricky to keep track of which volume, biomass, and carbon equation to use. For example, a state like Maine has three different ecological divisions. Hence, the same-sized eastern white pine tree located in three different locations in the state could have three different estates of tree biomass.\n\nThis issue will arise for analysts that do statewide assessments using Forest Inventory and Analysis (FIA) data. While the FIA database has been updated with the new estimates of tree volume, biomass, and carbon, analysts often will need to use the FIA data and write customized functions based on the data.\n\nFortunately, the **PLOT** table in the FIA database contains the ecological subsection where the plot resides, stored in the **ECOSUBCD** variable. As described in the [FIA Database User Guide](https://www.fia.fs.usda.gov/library/database-documentation/), ecological subsections are defined as areas of \"similar surficial geology, lithology, geomorphic process, soil groups, subregional climate, and potential natural communities.\" This represents the most detailed level within the hierarchical framework. \n\nYou'll need to do some work to pull the ecological division out from this variable, and it's messy because of the alpha-numeric characteristics and differing lengths of of the **ECOSUBCD** variable. For example, **ECOSUBCD** 211Da in central Maine is termed the Central Maine Embayment Subsection.\n\nI'll use some functions from the **stringr** package in R to do this, which can be called from the tidyverse library:  \n\n```{r, warning = F, message = F}\nlibrary(tidyverse)\n```\n\n```{r, echo = F, warning = F, message = F}\n\nmy_wd <- \"C:/Users/matt/Documents/Arbor/Projects/Blog/\"\nme_plot<- read_csv(paste0(my_wd, \"ME_PLOT.csv\"))\n```\n\nFirst, I'll make a data table called *eco_codes* of all of the **ECOSUBCD** values list in Maine's PLOT table from FIA's *ME_PLOT.csv* file using the `as_tibble()` function. Then I'll rename the variables to something that makes sense. You can see that Maine has 19 unique ecological subsections:  \n\n```{r, warning = F, message = F}\neco_codes <- as_tibble(table(me_plot$ECOSUBCD), .name_repair = \"unique\") |> \n  rename(ECOSUBCD = ...1,\n         num_plots = n)\n\neco_codes\n```\n\nWe can determine the ecological province (**eco_province**) by using the `str_sub()` function by \"trimming off\" the subsection letters at the end of the subsection name. This can be done by specifying `end = -3` in the function.\n\nIf only it were that simple. To obtain the ecological division we need to \"round down\" the ecological province. For example, Ecological province 211 (Northeastern Mixed Forest Province) corresponds to ecological division 210 (Warm Continental Division). To do this you can replace the last character in the **eco_province** variable with a zero. This can be done with the `str_replace()` function and replacing the last character using the `\".$\"`  command.\n\nIn the end, you can see the relationships between the ecological subsection, province, and division codes: \n\n```{r}\neco_codes <- eco_codes |> \n  mutate(eco_province = str_sub(ECOSUBCD, end = -3),\n         eco_division = str_replace(eco_province, \".$\", \"0\"))\neco_codes\n```\n\nYou can see that most FIA plots in Maine are found in the Division 210 (Warm Continental Division), followed by M210 (Warm Continental Division - Mountain Provinces) and 220 (Hot Continental Division): \n\n```{r}\neco_codes |> \n  summarize(num_plots_division = sum(num_plots),\n            .by = \"eco_division\")\n```\n\nSurely, there must exist an ecological subsection lookup table that contains each subsection and its corresponding values for ecological sections, divisions, and so forth. I haven't been able to find one yet, but if you're aware of one, do let me know! For know I'll likely continue use functions like this to pull out these values.  \n\n--\n\n*By Matt Russell. [Email Matt](mailto:matt@arbor-analytics.com) with any questions or comments.*\n","srcMarkdownNoYaml":"\n\n\n<center>\n\n![*Ecological sections and subsections in Maine, USA (from Cleland et al. 2007).*](main_ecosections.png){width=500px}\n</center>\n##\n\nTo get a better feel for how they work, I've been digging into the new [tree volume, biomass, and carbon models](https://www.fs.usda.gov/research/programs/fia/nsvb) released by the USDA Forest Service last month. These new equations replace volume equations developed at the regional level and are now nationally-consistent. Importantly for anyone that works with forest carbon inventory data, these new equations replace the Component Ratio Method (CRM).\n\nAlthough the equations replace regional ones previously implemented, they do require a geographical variable not widely used in forest biomass and carbon equations: ecological division. These divisions are outlined in the US National Hierarchical Framework of Ecological Units, described in detail in a map produced by [Cleland and others](https://www.fs.usda.gov/research/treesearch/48672) in 2007. Within divisions there are ecological provinces. Within those provinces there are ecological sections and subsections. \n\nIf you're doing an analysis on an individual ownership, you can simply look up the property's ecological division and find the equations for the tree species that you need. But if you're doing an analysis at a larger scale, e.g., across a US state, there may exist multiple ecological divisions within your project area. Ecological divisions don't line up with regional, state, or county boundaries, making it tricky to keep track of which volume, biomass, and carbon equation to use. For example, a state like Maine has three different ecological divisions. Hence, the same-sized eastern white pine tree located in three different locations in the state could have three different estates of tree biomass.\n\nThis issue will arise for analysts that do statewide assessments using Forest Inventory and Analysis (FIA) data. While the FIA database has been updated with the new estimates of tree volume, biomass, and carbon, analysts often will need to use the FIA data and write customized functions based on the data.\n\nFortunately, the **PLOT** table in the FIA database contains the ecological subsection where the plot resides, stored in the **ECOSUBCD** variable. As described in the [FIA Database User Guide](https://www.fia.fs.usda.gov/library/database-documentation/), ecological subsections are defined as areas of \"similar surficial geology, lithology, geomorphic process, soil groups, subregional climate, and potential natural communities.\" This represents the most detailed level within the hierarchical framework. \n\nYou'll need to do some work to pull the ecological division out from this variable, and it's messy because of the alpha-numeric characteristics and differing lengths of of the **ECOSUBCD** variable. For example, **ECOSUBCD** 211Da in central Maine is termed the Central Maine Embayment Subsection.\n\nI'll use some functions from the **stringr** package in R to do this, which can be called from the tidyverse library:  \n\n```{r, warning = F, message = F}\nlibrary(tidyverse)\n```\n\n```{r, echo = F, warning = F, message = F}\n# Set working directory\n\nmy_wd <- \"C:/Users/matt/Documents/Arbor/Projects/Blog/\"\nme_plot<- read_csv(paste0(my_wd, \"ME_PLOT.csv\"))\n```\n\nFirst, I'll make a data table called *eco_codes* of all of the **ECOSUBCD** values list in Maine's PLOT table from FIA's *ME_PLOT.csv* file using the `as_tibble()` function. Then I'll rename the variables to something that makes sense. You can see that Maine has 19 unique ecological subsections:  \n\n```{r, warning = F, message = F}\neco_codes <- as_tibble(table(me_plot$ECOSUBCD), .name_repair = \"unique\") |> \n  rename(ECOSUBCD = ...1,\n         num_plots = n)\n\neco_codes\n```\n\nWe can determine the ecological province (**eco_province**) by using the `str_sub()` function by \"trimming off\" the subsection letters at the end of the subsection name. This can be done by specifying `end = -3` in the function.\n\nIf only it were that simple. To obtain the ecological division we need to \"round down\" the ecological province. For example, Ecological province 211 (Northeastern Mixed Forest Province) corresponds to ecological division 210 (Warm Continental Division). To do this you can replace the last character in the **eco_province** variable with a zero. This can be done with the `str_replace()` function and replacing the last character using the `\".$\"`  command.\n\nIn the end, you can see the relationships between the ecological subsection, province, and division codes: \n\n```{r}\neco_codes <- eco_codes |> \n  mutate(eco_province = str_sub(ECOSUBCD, end = -3),\n         eco_division = str_replace(eco_province, \".$\", \"0\"))\neco_codes\n```\n\nYou can see that most FIA plots in Maine are found in the Division 210 (Warm Continental Division), followed by M210 (Warm Continental Division - Mountain Provinces) and 220 (Hot Continental Division): \n\n```{r}\neco_codes |> \n  summarize(num_plots_division = sum(num_plots),\n            .by = \"eco_division\")\n```\n\nSurely, there must exist an ecological subsection lookup table that contains each subsection and its corresponding values for ecological sections, divisions, and so forth. I haven't been able to find one yet, but if you're aware of one, do let me know! For know I'll likely continue use functions like this to pull out these values.  \n\n--\n\n*By Matt Russell. [Email Matt](mailto:matt@arbor-analytics.com) with any questions or comments.*\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.553","theme":{"light":"minty","dark":"slate"},"title-block-banner":true,"title":"A handy R function for getting ecological division from FIA data","description":"Some functions from the R's stringr package to obtain ecological division.","author":"Matt Russell","date":"2023-11-18","slug":[],"categories":[],"tags":["data management","forest carbon","forest inventory and analysis","forest inventory","ecodivision"],"image":"main_ecosections.png"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}